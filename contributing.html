<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贡献指南 - NipaPlay</title>
    <meta name="description" content="欢迎参与 NipaPlay 项目贡献！本指南将帮助您了解如何设置环境、项目结构以及贡献流程。">
    <style>
:root {
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", "Helvetica Neue", sans-serif;
    
    /* Light Theme */
    --bg-color-light: #f5f5f5;
    --bg-secondary-color-light: #ffffff;
    --text-color-light: #1a1a1a;
    --text-secondary-color-light: #5a5a5a;
    --accent-color-light: #0078d4;
    --accent-hover-color-light: #005a9e;
    --border-color-light: #e0e0e0;
    --shadow-color-light: rgba(0, 0, 0, 0.08);

    /* Dark Theme */
    --bg-color-dark: #1a1a1a;
    --bg-secondary-color-dark: #2c2c2c;
    --text-color-dark: #f5f5f5;
    --text-secondary-color-dark: #a0a0a0;
    --accent-color-dark: #2894ff;
    --accent-hover-color-dark: #50a8ff;
    --border-color-dark: #404040;
    --shadow-color-dark: rgba(0, 0, 0, 0.3);
}

[data-theme="light"] {
    --bg-color: var(--bg-color-light);
    --bg-secondary-color: var(--bg-secondary-color-light);
    --text-color: var(--text-color-light);
    --text-secondary-color: var(--text-secondary-color-light);
    --accent-color: var(--accent-color-light);
    --accent-hover-color: var(--accent-hover-color-light);
    --border-color: var(--border-color-light);
    --shadow-color: var(--shadow-color-light);
}

[data-theme="dark"] {
    --bg-color: var(--bg-color-dark);
    --bg-secondary-color: var(--bg-secondary-color-dark);
    --text-color: var(--text-color-dark);
    --text-secondary-color: var(--text-secondary-color-dark);
    --accent-color: var(--accent-color-dark);
    --accent-hover-color: var(--accent-hover-color-dark);
    --border-color: var(--border-color-dark);
    --shadow-color: var(--shadow-color-dark);
}

/* General Styles */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: var(--font-family);
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background-color 0.3s ease, color 0.3s ease;
    line-height: 1.6;
}

a {
    color: var(--accent-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--accent-hover-color);
}

/* Header */
.main-header {
    position: sticky;
    top: 0;
    width: 100%;
    z-index: 1000;
    background-color: color-mix(in srgb, var(--bg-color) 80%, transparent);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
}

.main-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem;
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--text-color);
}

.logo img {
    height: 32px;
    width: 32px;
}

.nav-right {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.nav-links {
    display: flex;
    gap: 2rem;
}

.nav-links a {
    color: var(--text-secondary-color);
    font-weight: 500;
}
.nav-links a:hover {
    color: var(--text-color);
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.theme-toggle {
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}
.theme-toggle:hover {
    background-color: var(--border-color);
}

/* Main Content Area */
.guide-container {
    display: flex;
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

/* Sidebar */
.guide-sidebar {
    flex: 0 0 280px;
    position: sticky;
    top: 80px; /* Height of header */
    height: calc(100vh - 80px);
    overflow-y: auto;
    padding-right: 2rem;
    border-right: 1px solid var(--border-color);
}

.guide-sidebar h3 {
    font-size: 1.2rem;
    margin-bottom: 1rem;
    color: var(--text-color);
}

.guide-nav {
    list-style: none;
}

.guide-nav a {
    display: block;
    padding: 0.6rem 1rem;
    border-radius: 6px;
    color: var(--text-secondary-color);
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.guide-nav a:hover {
    background-color: var(--border-color);
    color: var(--text-color);
}

.guide-nav a.active {
    background-color: var(--accent-color);
    color: white;
}
.guide-nav a.active:hover {
    background-color: var(--accent-hover-color);
    color: white;
}

/* Content */
.guide-content {
    flex: 1;
    padding-left: 3rem;
    min-width: 0; /* Prevents flexbox overflow */
}

.guide-content-inner {
    max-width: 800px;
}

/* Markdown Content Styles */
.guide-content-inner h1, .guide-content-inner h2, .guide-content-inner h3 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-color);
}
.guide-content-inner h1 { font-size: 2.5rem; }
.guide-content-inner h2 { font-size: 2rem; }
.guide-content-inner h3 { font-size: 1.5rem; }

.guide-content-inner p {
    margin-bottom: 1rem;
    line-height: 1.7;
}

.guide-content-inner ul, .guide-content-inner ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

.guide-content-inner li {
    margin-bottom: 0.5rem;
}

.guide-content-inner code {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: var(--bg-secondary-color);
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    border-radius: 6px;
}

.guide-content-inner pre {
    background-color: var(--bg-secondary-color);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1rem;
    overflow-x: auto;
}

.guide-content-inner pre code {
    padding: 0;
    margin: 0;
    font-size: inherit;
    background: none;
}

.guide-content-inner blockquote {
    border-left: 4px solid var(--accent-color);
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: var(--text-secondary-color);
}

.guide-content-inner table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
}

.guide-content-inner th, .guide-content-inner td {
    border: 1px solid var(--border-color);
    padding: 0.75rem;
    text-align: left;
}

.guide-content-inner th {
    background-color: var(--bg-secondary-color);
}

/* Footer */
.main-footer {
    padding: 2rem 0;
    border-top: 1px solid var(--border-color);
}

.footer-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
}

.footer-content p {
    color: var(--text-secondary-color);
}

.footer-links {
    display: flex;
    gap: 1.5rem;
}

.footer-links a {
    color: var(--text-secondary-color);
}

.footer-links a:hover {
    color: var(--text-color);
}

/* Responsive */
@media (max-width: 992px) {
    .guide-container {
        flex-direction: column;
    }
    .guide-sidebar {
        position: static;
        height: auto;
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        padding-right: 0;
        margin-bottom: 2rem;
        overflow-y: visible;
    }
    .guide-content {
        padding-left: 0;
    }
}

    </style>
    <link rel="icon" href="assets/icon.webp" type="image/webp">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <style>
        /* Tweaks for highlight.js */
        .guide-content-inner pre code.hljs {
            padding: 1em;
            border-radius: 6px;
        }
        [data-theme="light"] .guide-content-inner pre code.hljs {
            background: #f6f8fa;
            color: #24292e;
        }
        [data-theme="dark"] .guide-content-inner pre code.hljs {
            background: #2c2c2c;
            color: #f5f5f5;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <nav class="main-nav">
            <a href="index.html" class="logo">
                <img src="assets/icon.webp" alt="NipaPlay Icon">
                <span>NipaPlay</span>
            </a>
            <div class="nav-right">
                <div class="nav-links">
                    <a href="index.html#features">功能特性</a>
                    <a href="index.html#gallery">软件截图</a>
                    <a href="contributing.html">贡献指南</a>
                    <a href="https://github.com/MCDFsteve/NipaPlay-Reload" target="_blank">项目地址</a>
                </div>
                <div class="nav-actions">
                    <button id="theme-toggle" class="theme-toggle" aria-label="切换日间/夜间模式">
                        <i class="ri-sun-line"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="guide-container">
        <aside class="guide-sidebar">
            <h3>导航</h3>
            <ul id="guide-nav" class="guide-nav">
                <!-- Navigation items will be injected by JavaScript -->
            </ul>
        </aside>
        <section class="guide-content">
            <div id="guide-content-inner" class="guide-content-inner">
                <!-- Content will be injected by JavaScript -->
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <p>&copy; 2025 NipaPlay. All Rights Reserved. Developed by <a href="http://www.aimes-soft.com" target="_blank">Aimes Soft</a>.</p>
            <div class="footer-links">
                <a href="https://github.com/MCDFsteve/NipaPlay-Reload" target="_blank">GitHub</a>
                <a href="https://github.com/MCDFsteve/NipaPlay-Reload/issues" target="_blank">问题反馈</a>
            </div>
        </div>
    </footer>

    <!-- Marked.js for Markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js for Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dart.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements --- //
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('i');
        const docElement = document.documentElement;
        const guideNav = document.getElementById('guide-nav');
        const guideContent = document.getElementById('guide-content-inner');

        let guidesData = [];

        // --- Functions --- //

        /**
         * Sets the color theme for the site.
         * @param {string} theme - The theme to set ('dark' or 'light').
         */
        const setTheme = (theme) => {
            docElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeIcon.className = theme === 'dark' ? 'ri-moon-line' : 'ri-sun-line';
        };

        /**
         * Renders the selected guide content.
         * @param {string} guideId - The ID of the guide to render.
         */
        const renderGuide = (guideId) => {
            const guide = guidesData.find(g => g.id === guideId);
            if (guide) {
                guideContent.innerHTML = marked.parse(guide.content);
                // After rendering, find all code blocks and highlight them
                guideContent.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
                updateActiveLink(guideId);
                window.scrollTo(0, 0); // Scroll to top on content change
            } else if (guideId) { // Avoid showing error on initial empty hash
                guideContent.innerHTML = '<p>无法加载该指南，请稍后再试。</p>';
            }
        };

        /**
         * Updates the active state in the sidebar navigation.
         * @param {string} activeId - The ID of the currently active guide.
         */
        const updateActiveLink = (activeId) => {
            const links = guideNav.querySelectorAll('a');
            links.forEach(link => {
                if (link.dataset.id === activeId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        };

        /**
         * Populates the sidebar navigation.
         */
        const populateNav = () => {
            if (!guidesData || guidesData.length === 0) return;
            
            guideNav.innerHTML = ''; // Clear existing nav
            guidesData.forEach(guide => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${guide.id}`;
                a.textContent = guide.name;
                a.dataset.id = guide.id;
                li.appendChild(a);
                guideNav.appendChild(li);
            });
        };

        const handleNavigation = (hash) => {
            const guideId = hash.substring(1) || (guidesData.length > 0 ? guidesData[0].id : '');
            if (guideId) {
                renderGuide(guideId);
            }
        }

        // --- Event Handlers --- //

        guideNav.addEventListener('click', (e) => {
            const link = e.target.closest('a');
            if (link && link.dataset.id) {
                // We don't need to prevent default, as the default action (changing hash) is what we want.
                // The 'hashchange' event will take care of rendering.
            }
        });

        // Listen for hash changes to render the correct guide
        window.addEventListener('hashchange', () => handleNavigation(window.location.hash));

        // --- Initializations --- //

        // 1. Set Theme
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        setTheme(savedTheme || (prefersDark ? 'dark' : 'light'));

        // 2. Fetch and render guides
        fetch('guides.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                guidesData = data;
                populateNav();
                // Initial load based on current hash
                handleNavigation(window.location.hash);
            })
            .catch(error => {
                console.error("Error fetching guides:", error);
                guideContent.innerHTML = '<p>贡献指南加载失败。请检查文件是否存在或稍后重试。</p>';
            });

        // --- Event Listeners --- //
        themeToggle.addEventListener('click', () => {
            const currentTheme = docElement.getAttribute('data-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!localStorage.getItem('theme')) {
                setTheme(e.matches ? 'dark' : 'light');
            }
        });
    });
    </script>
</body>
</html>
